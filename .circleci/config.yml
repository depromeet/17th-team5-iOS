version: 2.1

jobs:
  build-ios:
    macos:
      xcode: 16.2.0
    resource_class: macos.m1.medium.gen1
    steps:
      - checkout
      - run:
          name: "Install mise and Tuist"
          command: |
            cd Sample
            curl https://mise.run | sh
            echo 'export PATH="$HOME/.local/bin:$PATH"' >> $BASH_ENV
            source $BASH_ENV
            mise use tuist@latest
            echo 'eval "$(/Users/distiller/.local/bin/mise activate bash)"' >> $BASH_ENV
      - run:
          name: "Install dependencies"
          command: |
            cd Sample
            source $BASH_ENV
            eval "$(/Users/distiller/.local/bin/mise activate bash)"
            tuist install
      - run:
          name: "Generate Xcode project"
          command: |
            cd Sample
            source $BASH_ENV
            eval "$(/Users/distiller/.local/bin/mise activate bash)"
            tuist generate
      - run:
          name: "Build project"
          command: |
            cd Sample
            xcodebuild -workspace Sample.xcworkspace -scheme Sample -destination 'platform=iOS Simulator,name=iPhone 15' build

workflows:
  ios-ci-workflow:
    jobs:
      - build-ios:
          filters:
            branches:
              only: 
                - main
                - /feature\/IC-12\/.*/
